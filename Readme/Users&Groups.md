# Модель пользователя

В проекте была использована собственная модель пользователя, унаследованная от класса `AbstractBaseUser`. 
Помимо полей, как правило cуществующих, в стандартной модели пользователей, были добавлены поля "аватар", "город", "адрес", "телефон". 

Преимуществом этого подхода является избежание дополнительного запроса на каждого пользователя в дополняющую стандарнтую модель. 
Также в модели пользователя был переопределен метод `save()` - добавлена проверка размерности загружаемого файла аватара, а также удаление старого файла при изменении аватара:
```python3
    def save(self, *args, **kwargs) -> None:
        check_image_size(self.avatar)
        if self.pk is not None:
            old_self = User.objects.get(pk=self.pk)
            if old_self.avatar and self.avatar != old_self.avatar:
                old_self.avatar.delete(False)
        super(User, self).save(*args, **kwargs)
```
Для удобства доступа к ссылке аватара был добавлен метод avatar_url:
```python3
    @property
    def avatar_url(self):
        if self.avatar and hasattr(self.avatar, 'url'):
            return self.avatar.url
```
Также добавлены права доступа для пользователей, для последующего создания групп:
1. Контент-менеджер - пользователи с полным доступом в админ-панель
2. Продавцы - без доступа в админ-панель, но имеющие доступ в специальный раздел для продавцов в личном кабинете

## Аутентификация и регистрация пользователей:

Аутентификация и регистрация пользователей реализована по e-mail адресу. 
Чтобы войти на сайт, необходимо ввести свой email и пароль на странице логина, в случае если пользователь не зарегистрирован - зарегистрироваться

Также имеется возможность входа на сайт через сторонние сервисы. По умолчанию таковых доступно лишь 2: через google и через vk. 
Однако процедура добавления дополнительных сторонних сервисов довольно проста. 

Данный сервис реализован с помощью подключаемого приложения `django-allauth`, который уже имеет множество доступных сервисов. 
Чтобы подключить один из них, необходимо всего 4 шага:
1. Добавить в файл вирутального окружения переменную:
```env 
INSTALLED_APPS='allauth.socialaccount.<название_сервиса1>','allauth.socialaccount.<название_сервиса2>',...
``` 
> #### Примечание:
> Названия доступных сервисов в файле `Readme/socialproviders.md`

2. Для фронтенда - добавить в папку `/static/assets/img/icons/socialContent/` файл иконки вида `<название сервиса>.svg` размером 16x16.

3. На выбранном стороннем сервисе создать api-приложение

4. Через админ-панель добавить сервис в `social applications`, скопировав из п.3 ключи доступа

Личный кабинет
Для всех пользователей
После регистрации и аутентификации пользователю будет доступет личный кабинет. В нем есть возможность отредактировать введенные при регистрации данные, изменить/добавить аватар. 
В техническом плане это реализовано через стандартные средства django. Также в личном кабинете представлены последние ордера и несколько последних просмотренных товаров, с кнопками на полные списки.
Для продавцов
В случае если пользователь приналежит группе 'Продавцы', ему будет доступен кабинет продавцов в личном кабинете. В данном кабинете релазиованы следующие сервисы:
- создание, удаление и редактирование магазинов;
- создание, удаление и редактирование товаров этих магазинов, а также импорт товаров из файла;
- запрос на добавление нового базового товара;
- создание удаление и редактирование скидок (3-х типов).
Все методы реализации представлены в приложении `stores_app.services`. Для работы с моделями используется миксин `StoreServiceMixin`.