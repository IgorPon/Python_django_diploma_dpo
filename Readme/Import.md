# Сервис импорта товаров в магазин

Данный сервис доступен только пользователям-продавцам в личном кабинете.
На странице импорта присутствует форма, ожидающая от пользователя файла
в формате .json.

Структура товара в данном файле может иметь несколько вариантов:

Вариант 1 без скидки
```
{
    "Headphones A4Tech Bloody":{
                     "store": "1000-things",
                     "price": 270,
                     "quantity": 1
                     }, ......
    }
```
Вариант 2 если есть необходимость добавить скидку
```
{
    "GameTable for PC ThunderX3 ED2":{
                   "store": "1000-things",
                   "discount": {"title": "My_discount",
                                "description": "my disc. description",
                                "category": "First category",
                                "percent": 5,
                                "amount": 0,
                                "valid_from": "2022-04-02",
                                "valid_to": "2022-04-25"},
                   "price": 429,
                   "quantity": 2
                   }, ...
    }
```
В базе данных реализована таблица с флагом, обозначающим 
очередь(занято/свободно). Таким образом, после отправки файла, если нет
места в очереди, файл не будет обработан, пока очередь не освободится.
Отправка и обработка файла происходит асинхронно (celery).

Полученный файл парсится, учитываются все ошибки и исключения, ведется лог. 
Если нет ошибок объект создается в базе данных, если ошибка 
возникает на каком либо товаре он не добавится в базу, но обработка продолжится.
Если отправить такие же товары, то изменятся цены и 
количество существующих. Если магазин не принадлежит пользователю, это
также логируется.

В результате на странице можно посмотреть все свои импорты, раскрыть их
и посмотреть логи.

